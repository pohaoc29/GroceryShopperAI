name: Auto Sync Fork

on:
  schedule:
    # 10-minute sync windows:
    # PST 01:00–04:00  → UTC 09:00–12:00
    - cron: "*/10 9-12 * * *"

    # PST 08:00–13:00 → UTC 16:00–21:00
    - cron: "*/10 16-21 * * *"

    # All other hours → 60-minute sync
    # Outside of: 01–04, 08–13 PST
    # i.e., PST 04–08 → UTC 12–16, PST 13–01 → UTC 21–09
    - cron: "0 13-15 * * *"   # PST 05–07
    - cron: "0 0-8 * * *"     # PST 16–00 (UTC 00–08)
    - cron: "0 22-23 * * *"   # PST 14–15 (UTC 22–23)

  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout fork
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Add upstream
        run: git remote add upstream https://github.com/ychia112/GroceryShopperAI.git

      - name: Fetch upstream
        run: git fetch upstream

      - name: Merge upstream main
        run: |
          git checkout main
          git merge upstream/main --no-edit || true

      - name: Push updates to fork
        run: git push origin main
